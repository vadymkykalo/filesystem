{
  "description": "Примеры использования API маркетинговых фильтров после рефакторинга (без flat структуры)",
  "examples": {
    "createSimpleFilter": {
      "description": "Создание простого фильтра с условиями на корневом уровне (AND логика)",
      "method": "POST",
      "url": "/api/marketing-target-filters",
      "body": {
        "filterName": "Простой фильтр условий",
        "marketingTargetId": 1,
        "description": "Фильтр с простыми условиями AND логикой",
        "isActive": true,
        "conditions": [
          {
            "fieldType": "SMID",
            "operator": "EQUAL",
            "fieldValue": "3586067540",
            "orderIndex": 0
          },
          {
            "fieldType": "COUNTRY",
            "operator": "NOT_EQUAL",
            "fieldValue": "BY",
            "orderIndex": 1
          },
          {
            "fieldType": "OPERATING_SYSTEM",
            "operator": "CONTAINS",
            "fieldValue": "IOS",
            "orderIndex": 2
          }
        ]
      }
    },
    "createComplexFilterWithGroups": {
      "description": "Создание сложного фильтра: (SMID1 OR SMID2) AND COUNTRY=UA AND NOT_IN файл выборки",
      "method": "POST",
      "url": "/api/marketing-target-filters",
      "body": {
        "filterName": "Сложный фильтр с группами",
        "marketingTargetId": 1,
        "description": "Фильтр: (SMID1 или SMID2) И страна Украина И НЕ в файле выборки",
        "isActive": true,
        "conditions": [
          {
            "fieldType": "COUNTRY",
            "operator": "EQUAL",
            "fieldValue": "UA",
            "orderIndex": 0
          },
          {
            "fieldType": "DISTRIBUTION_GROUPS_FILE",
            "operator": "NOT_IN",
            "fieldValue": "48b14365-392c-4c83-8d06-324eadc312f3",
            "orderIndex": 1
          }
        ],
        "groups": [
          {
            "groupName": "SMID группа",
            "logicalOperator": "OR",
            "orderIndex": 0,
            "conditions": [
              {
                "fieldType": "SMID",
                "operator": "EQUAL",
                "fieldValue": "3586067540",
                "orderIndex": 0
              },
              {
                "fieldType": "SMID",
                "operator": "EQUAL",
                "fieldValue": "9876543210",
                "orderIndex": 1
              }
            ]
          }
        ]
      }
    },
    "createMultiGroupFilter": {
      "description": "Создание фильтра с несколькими группами: (Android OR iOS) AND (Chrome OR Safari) AND COUNTRY=UA",
      "method": "POST",
      "url": "/api/marketing-target-filters",
      "body": {
        "filterName": "Мульти-группа фильтр",
        "marketingTargetId": 1,
        "description": "Фильтр с несколькими группами условий",
        "isActive": true,
        "conditions": [
          {
            "fieldType": "COUNTRY",
            "operator": "EQUAL",
            "fieldValue": "UA",
            "orderIndex": 0
          }
        ],
        "groups": [
          {
            "groupName": "Операционные системы",
            "logicalOperator": "OR",
            "orderIndex": 0,
            "conditions": [
              {
                "fieldType": "OPERATING_SYSTEM",
                "operator": "CONTAINS",
                "fieldValue": "Android",
                "orderIndex": 0
              },
              {
                "fieldType": "OPERATING_SYSTEM",
                "operator": "CONTAINS",
                "fieldValue": "iOS",
                "orderIndex": 1
              }
            ]
          },
          {
            "groupName": "Браузеры",
            "logicalOperator": "OR",
            "orderIndex": 1,
            "conditions": [
              {
                "fieldType": "BROWSER",
                "operator": "CONTAINS",
                "fieldValue": "Chrome",
                "orderIndex": 0
              },
              {
                "fieldType": "BROWSER",
                "operator": "CONTAINS",
                "fieldValue": "Safari",
                "orderIndex": 1
              }
            ]
          }
        ]
      }
    },
    "updateFilter": {
      "description": "Обновление существующего фильтра",
      "method": "PUT",
      "url": "/api/marketing-target-filters/1",
      "body": {
        "filterName": "Обновленный фильтр",
        "marketingTargetId": 1,
        "description": "Обновленное описание фильтра",
        "isActive": true,
        "conditions": [
          {
            "fieldType": "CLIENT_VERSION",
            "operator": "GREATER_THAN",
            "fieldValue": "2.0.0",
            "orderIndex": 0
          }
        ],
        "groups": [
          {
            "groupName": "Браузер и интернет",
            "logicalOperator": "AND",
            "orderIndex": 0,
            "conditions": [
              {
                "fieldType": "BROWSER",
                "operator": "CONTAINS",
                "fieldValue": "Chrome",
                "orderIndex": 0
              },
              {
                "fieldType": "INTERNET_TYPE",
                "operator": "EQUAL",
                "fieldValue": "Wi-Fi",
                "orderIndex": 1
              }
            ]
          }
        ]
      }
    },
    "getFilter": {
      "description": "Получение фильтра по ID",
      "method": "GET",
      "url": "/api/marketing-target-filters/1"
    },
    "getAllFilters": {
      "description": "Получение всех фильтров",
      "method": "GET",
      "url": "/api/marketing-target-filters"
    },
    "getFiltersByTarget": {
      "description": "Получение фильтров по ID маркетинг таргета",
      "method": "GET",
      "url": "/api/marketing-target-filters/by-target/1"
    },
    "deleteFilter": {
      "description": "Удаление фильтра",
      "method": "DELETE",
      "url": "/api/marketing-target-filters/1"
    },
    "getFieldTypes": {
      "description": "Получение доступных типов полей",
      "method": "GET",
      "url": "/api/marketing-target-filters/field-types",
      "response": [
        "SMID",
        "DISTRIBUTION_GROUPS_FILE",
        "COUNTRY",
        "OPERATING_SYSTEM",
        "CLIENT_VERSION",
        "BROWSER",
        "INTERNET_TYPE",
        "INTERNAL_TRANSITION",
        "CLE_CAMPAIGN"
      ]
    },
    "getOperators": {
      "description": "Получение доступных операторов",
      "method": "GET",
      "url": "/api/marketing-target-filters/operators",
      "response": [
        "EQUAL",
        "NOT_EQUAL",
        "CONTAINS",
        "NOT_CONTAINS",
        "GREATER_THAN",
        "LESS_THAN",
        "GREATER_THAN_OR_EQUAL",
        "LESS_THAN_OR_EQUAL",
        "IN",
        "NOT_IN",
        "REGEX",
        "IS_NULL",
        "IS_NOT_NULL",
        "STARTS_WITH",
        "ENDS_WITH"
      ]
    },
    "getLogicalOperators": {
      "description": "Получение логических операторов",
      "method": "GET",
      "url": "/api/marketing-target-filters/logical-operators",
      "response": [
        "AND",
        "OR"
      ]
    },
    "validateFilterStructure": {
      "description": "Валидация структуры фильтра перед созданием/обновлением",
      "method": "POST",
      "url": "/api/marketing-target-filters/validate",
      "body": {
        "filterName": "Тестовый фильтр",
        "marketingTargetId": 1,
        "description": "Фильтр для валидации",
        "isActive": true,
        "conditions": [
          {
            "fieldType": "COUNTRY",
            "operator": "EQUAL",
            "fieldValue": "UA",
            "orderIndex": 0
          }
        ]
      },
      "response": {
        "valid": true,
        "message": "Filter structure is valid"
      }
    },
    "validateInvalidFilter": {
      "description": "Пример валидации невалидного фильтра",
      "method": "POST",
      "url": "/api/marketing-target-filters/validate",
      "body": {
        "filterName": "",
        "marketingTargetId": null,
        "isActive": true,
        "conditions": []
      },
      "response": {
        "valid": false,
        "message": "Filter name is required"
      }
    }
  },
  "filterEvaluation": {
    "evaluateFilterById": {
      "description": "Проверить соответствие пользователя фильтру по ID",
      "method": "POST",
      "url": "/api/marketing-target-filters/evaluate/1",
      "body": {
        "smid": "3586067540",
        "country": "UA",
        "operatingSystem": "iOS 15.0",
        "clientVersion": "2.238.1",
        "browser": "Safari",
        "language": "uk",
        "internetType": "Wi-Fi"
      },
      "response": {
        "filterId": 1,
        "matches": true
      }
    },
    "evaluateFilterDirect": {
      "description": "Проверить соответствие пользователя фильтру (передача фильтра в запросе)",
      "method": "POST",
      "url": "/api/marketing-target-filters/evaluate",
      "body": {
        "filter": {
          "filterName": "Тестовый фильтр",
          "marketingTargetId": 1,
          "description": "Фильтр для тестирования",
          "isActive": true,
          "conditions": [
            {
              "fieldType": "COUNTRY",
              "operator": "EQUAL",
              "fieldValue": "UA",
              "orderIndex": 0
            }
          ],
          "groups": [
            {
              "groupName": "SMID группа",
              "logicalOperator": "OR",
              "orderIndex": 0,
              "conditions": [
                {
                  "fieldType": "SMID",
                  "operator": "EQUAL",
                  "fieldValue": "3586067540",
                  "orderIndex": 0
                },
                {
                  "fieldType": "SMID",
                  "operator": "EQUAL",
                  "fieldValue": "9876543210",
                  "orderIndex": 1
                }
              ]
            }
          ]
        },
        "userRequest": {
          "smid": "3586067540",
          "country": "UA",
          "operatingSystem": "Android 12",
          "clientVersion": "2.1.0"
        }
      },
      "response": {
        "matches": true
      }
    },
    "evaluateComplexFilter": {
      "description": "Проверить сложный фильтр с группами",
      "method": "POST",
      "url": "/api/marketing-target-filters/evaluate/2",
      "body": {
        "smid": "9876543210",
        "country": "UA",
        "operatingSystem": "iOS 16.0",
        "clientVersion": "3.0.0",
        "browser": "Safari",
        "language": "uk"
      },
      "response": {
        "filterId": 2,
        "matches": true
      }
    },
    "evaluateFilterNoMatch": {
      "description": "Проверить фильтр - пользователь не подходит",
      "method": "POST",
      "url": "/api/marketing-target-filters/evaluate/1",
      "body": {
        "smid": "1111111111",
        "country": "PL",
        "operatingSystem": "Windows",
        "clientVersion": "1.0.0"
      },
      "response": {
        "filterId": 1,
        "matches": false
      }
    }
  },
  "testScenarios": {
    "scenario1_simple_filter": {
      "description": "Тестирование простого фильтра с условиями на корневом уровне",
      "steps": [
        "1. POST /api/marketing-target-filters - создать простой фильтр",
        "2. GET /api/marketing-target-filters/{id} - получить созданный фильтр",
        "3. POST /api/marketing-target-filters/evaluate/{id} - проверить пользователя (должен подходить)",
        "4. POST /api/marketing-target-filters/evaluate/{id} - проверить другого пользователя (не должен подходить)"
      ]
    },
    "scenario2_complex_filter": {
      "description": "Тестирование сложного фильтра с группами",
      "steps": [
        "1. POST /api/marketing-target-filters - создать фильтр с группами (SMID1 OR SMID2) AND COUNTRY=UA",
        "2. GET /api/marketing-target-filters/{id} - получить созданный фильтр",
        "3. POST /api/marketing-target-filters/evaluate/{id} - проверить SMID1 + UA (должен подходить)",
        "4. POST /api/marketing-target-filters/evaluate/{id} - проверить SMID2 + UA (должен подходить)",
        "5. POST /api/marketing-target-filters/evaluate/{id} - проверить SMID1 + PL (не должен подходить)"
      ]
    },
    "scenario3_distribution_file": {
      "description": "Тестирование фильтра с файлом выборки",
      "steps": [
        "1. POST /api/marketing-target-filters - создать фильтр с DISTRIBUTION_GROUPS_FILE NOT_IN",
        "2. POST /api/marketing-target-filters/evaluate/{id} - проверить SMID который есть в файле (не должен подходить)",
        "3. POST /api/marketing-target-filters/evaluate/{id} - проверить SMID которого нет в файле (должен подходить)"
      ]
    },
    "scenario4_multi_group": {
      "description": "Тестирование фильтра с несколькими группами",
      "steps": [
        "1. POST /api/marketing-target-filters - создать фильтр (Android OR iOS) AND (Chrome OR Safari) AND COUNTRY=UA",
        "2. POST /api/marketing-target-filters/evaluate/{id} - проверить Android + Chrome + UA (должен подходить)",
        "3. POST /api/marketing-target-filters/evaluate/{id} - проверить iOS + Safari + UA (должен подходить)",
        "4. POST /api/marketing-target-filters/evaluate/{id} - проверить Android + Firefox + UA (не должен подходить)",
        "5. POST /api/marketing-target-filters/evaluate/{id} - проверить Android + Chrome + PL (не должен подходить)"
      ]
    },
    "scenario5_crud_operations": {
      "description": "Тестирование CRUD операций",
      "steps": [
        "1. POST /api/marketing-target-filters - создать фильтр",
        "2. GET /api/marketing-target-filters/{id} - получить фильтр",
        "3. PUT /api/marketing-target-filters/{id} - обновить фильтр",
        "4. GET /api/marketing-target-filters/{id} - проверить обновления",
        "5. DELETE /api/marketing-target-filters/{id} - удалить фильтр",
        "6. GET /api/marketing-target-filters/{id} - убедиться что фильтр удален (404)"
      ]
    }
  }
}
